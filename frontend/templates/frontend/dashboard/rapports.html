{% extends 'frontend/base_dashboard.html' %}
{% load static %}

{% block title %}Rapports{% endblock %}

{% block dashboard_content %}
<div class="p-4 md:p-8 space-y-6">
    <!-- En-tête -->
    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
        <div>
            <h1 class="text-dark dark:text-white text-2xl font-bold mb-1">Rapport de prévention</h1>
            <p class="text-gray-500 dark:text-gray-400">Analyse et recommandations personnalisées</p>
        </div>
        <div class="flex items-center gap-2">
            <button onclick=" alert('fonctionnalité en dev')"
                class="bg-primary hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium flex items-center gap-2">
                <i data-lucide="download" class="w-4 h-4"></i>
                <span class="hidden sm:inline">Télécharger PDF</span>
            </button>
            <button onclick="toggleContrast()"
                class="flex items-center gap-2 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-gray-700 dark:text-gray-300">
                <i data-lucide="moon" class="w-4 h-4 block dark:hidden"></i>
                <i data-lucide="sun" class="w-4 h-4 hidden dark:block"></i>
                <span class="hidden sm:inline">Contraste</span>
            </button>
        </div>
    </div>

    <!-- Aperçu du rapport -->
    <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700">
        <div class="p-6 border-b border-gray-200 dark:border-gray-700">
            <h2 class="text-dark dark:text-white text-xl font-semibold flex items-center gap-2">
                <i data-lucide="file-text" class="w-6 h-6 text-primary"></i>
                Rapport de la journée
            </h2>
        </div>
        <div class="p-6 space-y-6">
            <div class="flex items-center gap-2 text-gray-500 dark:text-gray-400">
                <i data-lucide="calendar" class="w-5 h-5"></i>
                <span id="report-date"></span>
            </div>

            <!-- Résumé des métriques -->
            <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                <div class="bg-light dark:bg-gray-700 rounded-xl p-4 border border-gray-200 dark:border-gray-600">
                    <div class="text-gray-500 dark:text-gray-400 mb-1">Risque moyen</div>
                    <div class="text-dark dark:text-white font-semibold">33/100</div>
                </div>
                <div class="bg-light dark:bg-gray-700 rounded-xl p-4 border border-gray-200 dark:border-gray-600">
                    <div class="text-gray-500 dark:text-gray-400 mb-1">Risque min</div>
                    <div class="text-[#22C58E] font-semibold">22/100</div>
                </div>
                <div class="bg-light dark:bg-gray-700 rounded-xl p-4 border border-gray-200 dark:border-gray-600">
                    <div class="text-gray-500 dark:text-gray-400 mb-1">Risque max</div>
                    <div class="text-[#EF4444] font-semibold">45/100</div>
                </div>
                <div class="bg-light dark:bg-gray-700 rounded-xl p-4 border border-gray-200 dark:border-gray-600">
                    <div class="text-gray-500 dark:text-gray-400 mb-1">Alertes</div>
                    <div class="text-dark dark:text-white font-semibold">3</div>
                </div>
                <div class="bg-light dark:bg-gray-700 rounded-xl p-4 border border-gray-200 dark:border-gray-600">
                    <div class="text-gray-500 dark:text-gray-400 mb-1">Amélioration</div>
                    <div class="text-[#22C58E] font-semibold flex items-center gap-1">
                        <i data-lucide="trending-down" class="w-4 h-4"></i>
                        -8%
                    </div>
                </div>
            </div>

            <!-- Graphique visuel simplifié -->
            <div class="bg-light dark:bg-gray-700 rounded-xl p-6 border border-gray-200 dark:border-gray-600">
                <div class="text-dark dark:text-white font-medium mb-4">Évolution du risque sur 24h</div>
                <div class="flex items-end justify-between h-32 gap-2">
                    <!-- Solution 1: Utiliser une liste fixe -->
                    <div class="flex-1 bg-primary rounded-t-lg opacity-80 hover:opacity-100 transition-opacity"
                        style="height: 64%"></div>
                    <div class="flex-1 bg-primary rounded-t-lg opacity-80 hover:opacity-100 transition-opacity"
                        style="height: 44%"></div>
                    <div class="flex-1 bg-primary rounded-t-lg opacity-80 hover:opacity-100 transition-opacity"
                        style="height: 70%"></div>
                    <div class="flex-1 bg-primary rounded-t-lg opacity-80 hover:opacity-100 transition-opacity"
                        style="height: 80%"></div>
                    <div class="flex-1 bg-primary rounded-t-lg opacity-80 hover:opacity-100 transition-opacity"
                        style="height: 76%"></div>
                    <div class="flex-1 bg-primary rounded-t-lg opacity-80 hover:opacity-100 transition-opacity"
                        style="height: 84%"></div>
                    <div class="flex-1 bg-primary rounded-t-lg opacity-80 hover:opacity-100 transition-opacity"
                        style="height: 90%"></div>
                    <div class="flex-1 bg-primary rounded-t-lg opacity-80 hover:opacity-100 transition-opacity"
                        style="height: 80%"></div>
                    <div class="flex-1 bg-primary rounded-t-lg opacity-80 hover:opacity-100 transition-opacity"
                        style="height: 70%"></div>
                    <div class="flex-1 bg-primary rounded-t-lg opacity-80 hover:opacity-100 transition-opacity"
                        style="height: 60%"></div>
                    <div class="flex-1 bg-primary rounded-t-lg opacity-80 hover:opacity-100 transition-opacity"
                        style="height: 52%"></div>
                    <div class="flex-1 bg-primary rounded-t-lg opacity-80 hover:opacity-100 transition-opacity"
                        style="height: 48%"></div>
                </div>
                <div class="flex justify-between text-gray-500 dark:text-gray-400 mt-2 text-sm">
                    <span>00h</span>
                    <span>06h</span>
                    <span>12h</span>
                    <span>18h</span>
                    <span>24h</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Recommandations principales -->
    <div>
        <div class="flex items-center gap-2 mb-4">
            <h2 class="text-dark dark:text-white text-xl font-semibold">Recommandations IA</h2>
            <div class="relative group">
                <button
                    class="inline-flex items-center justify-center w-5 h-5 rounded-full bg-gray-200 hover:bg-gray-300 transition-colors">
                    <i data-lucide="info" class="w-3 h-3 text-gray-600"></i>
                </button>
                <div
                    class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-sm rounded-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 w-64 text-center z-10">
                    Recommandations personnalisées basées sur l'analyse de vos données par notre IA.
                    <div
                        class="absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-800">
                    </div>
                </div>
            </div>
        </div>
        <div class="space-y-4">
            <!-- Recommandation 1 - Priorité haute -->
            <div
                class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 hover:shadow-lg transition-all">
                <div class="p-6">
                    <div class="flex items-start gap-4">
                        <div class="w-12 h-12 rounded-lg flex items-center justify-center flex-shrink-0 bg-[#FEE2E2]">
                            <i data-lucide="alert-triangle" class="w-6 h-6 text-[#DC2626]"></i>
                        </div>
                        <div class="flex-1">
                            <div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 mb-2">
                                <h3 class="text-dark dark:text-white font-semibold">Améliorer la qualité de l'air</h3>
                                <span
                                    class="px-3 py-1 bg-[#FEE2E2] text-[#DC2626] border border-[#EF4444] rounded-full text-sm font-medium">
                                    Priorité haute
                                </span>
                            </div>
                            <p class="text-gray-600 dark:text-gray-300">
                                Le niveau de CO₂ a dépassé 480 ppm à plusieurs reprises. Aérez régulièrement votre
                                espace.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recommandation 2 - Priorité moyenne -->
            <div
                class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 hover:shadow-lg transition-all">
                <div class="p-6">
                    <div class="flex items-start gap-4">
                        <div class="w-12 h-12 rounded-lg flex items-center justify-center flex-shrink-0 bg-[#FEF3C7]">
                            <i data-lucide="activity" class="w-6 h-6 text-[#D97706]"></i>
                        </div>
                        <div class="flex-1">
                            <div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 mb-2">
                                <h3 class="text-dark dark:text-white font-semibold">Optimiser l'humidité</h3>
                                <span
                                    class="px-3 py-1 bg-[#FEF3C7] text-[#D97706] border border-[#FF9F43] rounded-full text-sm font-medium">
                                    Priorité moyenne
                                </span>
                            </div>
                            <p class="text-gray-600 dark:text-gray-300">
                                L'humidité ambiante est descendue à 45%. Envisagez d'utiliser un humidificateur.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recommandation 3 - Priorité faible -->
            <div
                class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 hover:shadow-lg transition-all">
                <div class="p-6">
                    <div class="flex items-start gap-4">
                        <div class="w-12 h-12 rounded-lg flex items-center justify-center flex-shrink-0 bg-[#D1FAE5]">
                            <i data-lucide="check-circle" class="w-6 h-6 text-[#059669]"></i>
                        </div>
                        <div class="flex-1">
                            <div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 mb-2">
                                <h3 class="text-dark dark:text-white font-semibold">Maintenir l'activité physique</h3>
                                <span
                                    class="px-3 py-1 bg-[#D1FAE5] text-[#059669] border border-[#22C58E] rounded-full text-sm font-medium">
                                    Priorité faible
                                </span>
                            </div>
                            <p class="text-gray-600 dark:text-gray-300">
                                Votre rythme cardiaque au repos est stable et dans la norme. Continuez ainsi.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Insights IA -->
    <div class="bg-white dark:bg-gray-800 rounded-xl border-2 border-primary">
        <div class="p-6 border-b border-primary">
            <h2 class="text-primary text-xl font-semibold flex items-center gap-2">
                <i data-lucide="activity" class="w-6 h-6"></i>
                Insights IA
            </h2>
        </div>
        <div class="p-6 space-y-4">
            <!-- Insight Santé cardiaque -->
            <div class="bg-light dark:bg-gray-700 rounded-xl p-4 border border-gray-200 dark:border-gray-600">
                <div class="flex items-start gap-3 mb-3">
                    <i data-lucide="heart" class="w-5 h-5 text-[#EF4444] flex-shrink-0 mt-1"></i>
                    <div>
                        <div class="text-dark dark:text-white font-medium mb-1">Santé cardiaque</div>
                        <p class="text-gray-600 dark:text-gray-300">
                            Votre rythme cardiaque est stable avec une moyenne de 69 bpm.
                            Aucune anomalie détectée sur les dernières 24 heures.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Insight Qualité environnementale -->
            <div class="bg-light dark:bg-gray-700 rounded-xl p-4 border border-gray-200 dark:border-gray-600">
                <div class="flex items-start gap-3 mb-3">
                    <i data-lucide="activity" class="w-5 h-5 text-primary flex-shrink-0 mt-1"></i>
                    <div>
                        <div class="text-dark dark:text-white font-medium mb-1">Qualité environnementale</div>
                        <p class="text-gray-600 dark:text-gray-300">
                            L'environnement a été optimal pendant 75% du temps.
                            Les pics de CO<sub>2</sub> entre 12h et 14h nécessitent une attention.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Insight Tendance positive -->
            <div class="bg-light dark:bg-gray-700 rounded-xl p-4 border border-gray-200 dark:border-gray-600">
                <div class="flex items-start gap-3">
                    <i data-lucide="trending-down" class="w-5 h-5 text-[#22C58E] flex-shrink-0 mt-1"></i>
                    <div>
                        <div class="text-dark dark:text-white font-medium mb-1">Tendance positive</div>
                        <p class="text-gray-600 dark:text-gray-300">
                            Votre score de risque a diminué de 8% par rapport à la semaine dernière.
                            Continuez vos bonnes habitudes !
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- CTA Téléchargement -->
    <div class="bg-primary rounded-xl border border-primary text-white">
        <div class="p-6">
            <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
                <div>
                    <h3 class="text-xl font-semibold mb-2">Rapport complet disponible</h3>
                    <p class="opacity-90">
                        Téléchargez votre rapport détaillé au format PDF pour le partager avec votre médecin
                    </p>
                </div>
                <button onclick=" alert('fonctionnalité en dev')"
                    class="bg-white text-primary hover:bg-gray-100 px-6 py-3 rounded-lg font-medium flex items-center gap-2 flex-shrink-0 transition-colors">
                    <i data-lucide="download" class="w-4 h-4"></i>
                    Télécharger PDF
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    // Afficher la date du rapport
    document.getElementById('report-date').textContent = new Date().toLocaleDateString('fr-FR', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });

    // Gestion des tooltips
    document.addEventListener('DOMContentLoaded', function () {
        // Réinitialiser les icônes Lucide après le chargement
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        }
    });
</script>
{% endblock %}